//import org.eclipse.smarthome.model.script.ScriptServiceUtil

rule PowerGatewayInRule
when 
	Item powerGateway changed 
then
	//variables	
	var String name_string = ""
	var String value_string = ""
	//var float value=0


	name_string  = transform("REGEX", "[ ]*([A-Za-z_]*):[ ]*[0-9]*[ ]*", powerGateway.state.toString)
	value_string = transform("REGEX", "[ ]*[A-Za-z_]*:[ ]*([0-9]*)[ ]*", powerGateway.state.toString)
	logInfo("PowerGatewayInRule", "in string:>>" + powerGateway.state.toString + "<<")
        logInfo("PowerGatewayInRule", "name / value strings:>>" + name_string + "<<>>"  + value_string+"<<")
	
	if (name_string!==null && value_string!==null){
	
		val value=Float::parseFloat(value_string)
		
		if (name_string=="powerHeating"){
			powerHeating.postUpdate(value)
		}
		
		if (name_string=="powerPV"){
			powerPV.postUpdate(value);
		}	
		if (name_string=="powerUtility"){
			powerUtility.postUpdate(value);
		}
		if (name_string=="pwm_setpoint"){
                        pwm_setpoint.postUpdate(value);
                }

		if (name_string=="bal_power"){
			bal_power.postUpdate(value);
		}
		if (name_string=="watchdog_counter"){
			watchdog_counter.postUpdate(value);
		}
		if (name_string=="energyUtility"){
			energyUtility.postUpdate(value*0.001);
		}
		if (name_string=="energyHeat"){
			energyHeat.postUpdate(value*0.001);
		}
                if (name_string=="energyPV"){
                        energyPV.postUpdate(value*0.001);
                }

		if (name_string=="energyExport"){
			energyExport.postUpdate(value*0.001);
		}
		if (name_string=="unsalEnergyExport"){
			unsalEnergyExport.postUpdate(value*0.001);
		}
		if (name_string=="unsalEnergyImport"){
			unsalEnergyImport.postUpdate(value*0.001);
		}
		
		
   	}
end
